<div class="wizard-container">
  <!-- Application Title -->
  <h1 class="app-title">{{ 'APP_TITLE' | translate }}</h1>
  
  <!-- Progress Bar -->
  <mat-progress-bar 
    mode="determinate" 
    [value]="(currentStep / totalSteps) * 100" 
    class="progress-bar">
  </mat-progress-bar>
  <p class="step-indicator">{{ 'WIZARD.PROGRESS' | translate : { step: currentStep, total: totalSteps } }}</p>

  <!-- ================= Step 1: Personal Info ================= -->
  <h2 *ngIf="currentStep === 1" class="step-title">{{ 'WIZARD.STEP1' | translate }}</h2>
  <form *ngIf="currentStep === 1" [formGroup]="form1" aria-label="{{ 'PERSONAL_INFO_FORM' | translate }}">
    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.NAME' | translate }}</mat-label>
        <input matInput formControlName="name" />
        <mat-error *ngIf="form1.get('name')?.invalid && form1.get('name')?.touched">
          {{ 'ERRORS.NAME_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.NATIONAL_ID' | translate }}</mat-label>
        <input matInput formControlName="nationalId" />
        <mat-error *ngIf="form1.get('nationalId')?.invalid && form1.get('nationalId')?.touched">
          {{ 'ERRORS.NATIONAL_ID_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">

<mat-form-field appearance="fill">
  <mat-label>{{ 'FIELDS.DOB' | translate }}</mat-label>
  <input
    matInput
    [matDatepicker]="picker"
    formControlName="dob"
  />
  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
  <mat-datepicker #picker></mat-datepicker>
  <mat-error *ngIf="form1.get('dob')?.invalid && form1.get('dob')?.touched">
    {{ 'ERRORS.DOB_REQUIRED' | translate }}
  </mat-error>
</mat-form-field>


      
      <div class="form-field-full">
        <label class="form-label">{{ 'FIELDS.GENDER' | translate }}</label>
        <mat-radio-group formControlName="gender" class="radio-group-row">
          <mat-radio-button value="Male">{{ 'GENDER.MALE' | translate }}</mat-radio-button>
          <mat-radio-button value="Female">{{ 'GENDER.FEMALE' | translate }}</mat-radio-button>
          <mat-radio-button value="Transgender">{{ 'GENDER.TRANSGENDER' | translate }}</mat-radio-button>
        </mat-radio-group>
        <mat-error *ngIf="form1.get('gender')?.invalid && form1.get('gender')?.touched">
          {{ 'ERRORS.GENDER_REQUIRED' | translate }}
        </mat-error>
      </div>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.ADDRESS' | translate }}</mat-label>
        <input matInput formControlName="address" />
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.CITY' | translate }}</mat-label>
        <input matInput formControlName="city" />
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.STATE' | translate }}</mat-label>
        <input matInput formControlName="state" />
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.COUNTRY' | translate }}</mat-label>
        <mat-select formControlName="country" (selectionChange)="onCountryChange($event.value)">
          <mat-option *ngFor="let country of countries" [value]="country.code">
            {{ getCountryTranslationKey(country.name) | translate }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form1.get('country')?.invalid && form1.get('country')?.touched">
          {{ 'ERRORS.COUNTRY_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.PHONE' | translate }}</mat-label>
        <input matInput formControlName="phone" [placeholder]="'+' + selectedCountryCode + ' ' + ('PHONE_PLACEHOLDER' | translate)" />
        <mat-error *ngIf="form1.get('phone')?.invalid && form1.get('phone')?.touched">
          {{ 'ERRORS.PHONE_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.EMAIL' | translate }}</mat-label>
        <input matInput type="email" formControlName="email" />
        <mat-error *ngIf="form1.get('email')?.invalid && form1.get('email')?.touched">
          {{ 'ERRORS.EMAIL_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
    </div>
  </form>

  <!-- ================= Step 2: Family & Financial Info ================= -->
  <h2 *ngIf="currentStep === 2" class="step-title">{{ 'WIZARD.STEP2' | translate }}</h2>
  <form *ngIf="currentStep === 2" [formGroup]="form2" aria-label="{{ 'FAMILY_FINANCIAL_INFO_FORM' | translate }}">
    <div class="form-row">
      <div class="form-field-full">
        <label class="form-label form-label-title">{{ 'FIELDS.MARITAL_STATUS' | translate }}</label>
        <mat-radio-group formControlName="maritalStatus" class="radio-group-row">
          <mat-radio-button value="Single">{{ 'MARITAL_STATUS.SINGLE' | translate }}</mat-radio-button>
          <mat-radio-button value="Married">{{ 'MARITAL_STATUS.MARRIED' | translate }}</mat-radio-button>
        </mat-radio-group>
        <mat-error *ngIf="form2.get('maritalStatus')?.invalid && form2.get('maritalStatus')?.touched">
          {{ 'ERRORS.MARITAL_STATUS_REQUIRED' | translate }}
        </mat-error>
      </div>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.DEPENDENTS' | translate }}</mat-label>
        <input matInput type="number" formControlName="dependents" />
        <mat-error *ngIf="form2.get('dependents')?.hasError('min')">
          {{ 'ERRORS.DEPENDENTS_MIN' | translate }}
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <div class="form-field-select full-width">
        <label class="form-label">{{ 'FIELDS.EMPLOYMENT_STATUS' | translate }}</label>
        <mat-select formControlName="employmentStatus">
          <mat-option *ngFor="let status of employmentOptions" [value]="status">
            {{ getEmploymentTranslationKey(status) | translate }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form2.get('employmentStatus')?.invalid && form2.get('employmentStatus')?.touched">
          {{ 'ERRORS.EMPLOYMENT_STATUS_REQUIRED' | translate }}
        </mat-error>
      </div>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.MONTHLY_INCOME' | translate }}</mat-label>
        <input matInput type="number" formControlName="monthlyIncome" />
        <mat-error *ngIf="form2.get('monthlyIncome')?.hasError('min')">
          {{ 'ERRORS.MONTHLY_INCOME_MIN' | translate }}
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="fill">
        <mat-label>{{ 'FIELDS.HOUSING_STATUS' | translate }}</mat-label>
        <input matInput formControlName="housingStatus" />
        <mat-error *ngIf="form2.get('housingStatus')?.invalid && form2.get('housingStatus')?.touched">
          {{ 'ERRORS.HOUSING_STATUS_REQUIRED' | translate }}
        </mat-error>
      </mat-form-field>
    </div>
  </form>

  <!-- ================= Step 3: Situation Descriptions ================= -->
  <h2 *ngIf="currentStep === 3" class="step-title">{{ 'WIZARD.STEP3' | translate }}</h2>
  <form *ngIf="currentStep === 3" [formGroup]="form3" aria-label="{{ 'SITUATION_DESCRIPTIONS_FORM' | translate }}">
    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>{{ 'FIELDS.FINANCIAL_SITUATION' | translate }}</mat-label>
        <textarea matInput formControlName="financialSituation"></textarea>
      </mat-form-field>
      <button mat-stroked-button color="primary" type="button" (click)="openHelp('financialSituation')">
        {{ 'HELP_ME_WRITE' | translate }}
      </button>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>{{ 'FIELDS.EMPLOYMENT_CIRCUMSTANCES' | translate }}</mat-label>
        <textarea matInput formControlName="employmentCircumstances"></textarea>
      </mat-form-field>
      <button mat-stroked-button color="primary" type="button" (click)="openHelp('employmentCircumstances')">
        {{ 'HELP_ME_WRITE' | translate }}
      </button>
    </div>

    <div class="form-row">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>{{ 'FIELDS.REASON' | translate }}</mat-label>
        <textarea matInput formControlName="reason"></textarea>
      </mat-form-field>
      <button mat-stroked-button color="primary" type="button" (click)="openHelp('reason')">
        {{ 'HELP_ME_WRITE' | translate }}
      </button>
    </div>
  </form>

  <!-- ================= Navigation Buttons ================= -->
  <div class="nav-buttons">
    <button mat-button type="button" (click)="prevStep()" [disabled]="currentStep === 1">
      {{ 'BACK' | translate }}
    </button>
    
    <button 
      mat-raised-button 
      color="primary" 
      type="button" 
      *ngIf="currentStep < totalSteps" 
      (click)="nextStep()" 
      [disabled]="!isStepValid()">
      {{ 'NEXT' | translate }}
    </button>
    
    <button 
      mat-raised-button 
      color="accent" 
      type="button" 
      *ngIf="currentStep === totalSteps" 
      (click)="onSubmit()" 
      [disabled]="!isStepValid()">
      {{ 'SUBMIT' | translate }}
    </button>
  </div>
</div>